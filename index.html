<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>USO AccessAbility Series – Practice Test</title>
  <style>
    :root {
      --primary: #2c5aa0;
      --primary-dark: #1e437d;
      --gray: #6c757d;
      --light: #f8f9fa;
      --bg: #ffffff;
      --text: #111;
    }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      margin: 0;
      padding: 16px 12px;
      background: var(--light);
      color: var(--text);
      line-height: 1.5;
    }
    .container { max-width: 1200px; margin: 0 auto; }
    h1 { font-size: clamp(1.6rem, 5vw, 2.2rem); text-align: center; margin: 1rem 0 0.5rem; color: var(--primary); }
    .subtitle { text-align: center; color: #555; margin: 0 0 1.5rem; font-size: 1rem; }
    .progress { text-align: center; color: #666; margin: 1rem 0; font-size: 1rem; font-weight: 500; }
    .questions-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 1.5rem;
      margin-bottom: 2rem;
    }
    .question-card {
      background: var(--bg);
      border-radius: 12px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.08);
      padding: 1.5rem;
      border: 1px solid #e0e0e0;
    }
    .question {
      font-size: 1.1rem;
      font-weight: 600;
      margin: 0 0 1.2rem;
    }
    .options {
      display: flex;
      flex-direction: column;
      gap: 0.8rem;
    }
    label.option {
      display: flex;
      align-items: center;
      padding: 0.9rem 1.1rem;
      background: #f5f7fa;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.15s;
      font-size: 1rem;
      user-select: none;
    }
    label.option:hover, label.option:focus-within {
      background: #e8eef5;
      transform: translateY(-1px);
    }
    input[type="radio"] {
      margin-right: 0.9rem;
      accent-color: var(--primary);
      transform: scale(1.2);
      flex-shrink: 0;
    }
    .btn {
      padding: 0.9rem;
      font-size: 1.05rem;
      font-weight: 600;
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: background 0.2s;
      width: 100%;
      margin: 1.2rem 0 0.6rem;
    }
    .btn-primary { background: var(--primary); }
    .btn-primary:hover { background: var(--primary-dark); }
    .btn:disabled { background: #a0aec0; cursor: not-allowed; }
    .btn-nav { flex: 1; padding: 0.9rem; }
    .btn-secondary { background: var(--gray); }
    .btn-secondary:hover { background: #5a6268; }
    .nav-buttons { display: flex; gap: 1rem; margin: 2rem 0 1rem; }
    .result {
      margin-top: 1rem;
      padding: 1rem;
      border-radius: 10px;
      font-weight: 600;
      text-align: center;
      display: none;
    }
    .correct { background: #e6ffe6; color: #006600; border: 1px solid #b3ffb3; }
    .wrong   { background: #ffe6e6; color: #990000; border: 1px solid #ffb3b3; }
    .score-summary {
      text-align: center;
      font-size: 1.4rem;
      font-weight: bold;
      margin: 3rem 0 2rem;
      color: var(--primary);
    }
    @media (min-width: 768px) {
      .questions-grid { grid-template-columns: repeat(auto-fit, minmax(380px, 1fr)); }
      body { padding: 2rem 1.5rem; }
      .nav-buttons { max-width: 500px; margin: 2.5rem auto; }
      .progress { font-size: 1.1rem; }
    }
    .hidden { display: none !important; }
  </style>
</head>
<body>

<div class="container">
  <h1>USO AccessAbility Series – Practice Test</h1>
  <p class="subtitle">100 Questions – General Knowledge, Math, Science, English & Life Skills</p>

  <div class="progress" id="progress">Loading questions...</div>

  <div class="questions-grid" id="questions-container"></div>

  <div class="nav-buttons" id="nav">
    <button class="btn btn-secondary btn-nav" id="prevBtn" disabled>Previous</button>
    <button class="btn btn-primary btn-nav" id="nextBtn">Next Page</button>
  </div>

  <div id="summary" class="score-summary" style="display:none;"></div>
</div>

<script>
let quizData = [];
let currentPage = 0;
let score = 0;
const answers = {};
const questionsPerPageMobile = 1;
const questionsPerPageDesktop = 4;
let questionsPerPage = window.innerWidth < 768 ? questionsPerPageMobile : questionsPerPageDesktop;

const container = document.getElementById('questions-container');
const progress = document.getElementById('progress');
const prevBtn = document.getElementById('prevBtn');
const nextBtn = document.getElementById('nextBtn');
const summaryDiv = document.getElementById('summary');

async function loadQuestions() {
  try {
    const res = await fetch('questions.json');
    if (!res.ok) throw new Error('Cannot load questions.json – make sure the file exists in the same folder');
    const json = await res.json();
    // support both an array or an object with a 'questions' array
    quizData = Array.isArray(json) ? json : (json.questions || []);

    // normalize each question: ensure options array and a canonical 'correct' letter
    quizData = quizData.map((q, i) => {
      const options = Array.isArray(q.options) ? q.options.slice() : (Array.isArray(q.choices) ? q.choices.slice() : []);
      const correct = (q.correct ?? q.correct_answer ?? q.correctAnswer ?? '').toString().trim().toUpperCase();
      return { ...q, options, correct };
    });

    if (quizData.length === 0) throw new Error('No questions found in JSON');
    renderPage();
  } catch (err) {
    progress.textContent = 'Error: ' + err.message;
    console.error(err);
  }
} 

function isMobile() {
  return window.innerWidth < 768;
}

function renderPage() {
  container.innerHTML = '';
  questionsPerPage = isMobile() ? questionsPerPageMobile : questionsPerPageDesktop;

  const start = currentPage * questionsPerPage;
  const end = Math.min(start + questionsPerPage, quizData.length);
  const pageItems = quizData.slice(start, end);

  pageItems.forEach(q => {
    const idx = q.id - 1;
    const answered = answers[idx] !== undefined;

    // uplevel: use normalized options & correct from loadQuestions
    const optionsArr = Array.isArray(q.options) ? q.options : (Array.isArray(q.choices) ? q.choices : []);
    const correctLetter = (q.correct ?? q.correct_answer ?? q.correctAnswer ?? '').toString().trim().toUpperCase();

    const card = document.createElement('div');
    card.className = 'question-card';
    card.innerHTML = `
      <div class="question">${q.id}. ${q.question}</div>
      <div class="options">
        ${optionsArr.map((opt, i) => {
          const letter = String.fromCharCode(65 + i);
          const display = String(opt).replace(/^[A-Za-z][:\)\.\-]\s*/,'').trim();
          const checked = answered && (answers[idx] && answers[idx].toUpperCase() === letter) ? 'checked' : '';
          const disabled = answered ? 'disabled' : '';
          return `
            <label class="option">
              <input type="radio" name="q${q.id}" value="${letter}" ${checked} ${disabled}>
              ${letter}) ${display}
            </label>
          `;
        }).join('')}
      </div>
      <button type="button" class="btn btn-primary ${answered ? 'hidden' : ''}" id="submit${q.id}" ${answered ? '' : 'disabled'}>
        Check Answer
      </button>
      <div id="result${q.id}" class="result" style="${answered ? 'display:block;' : 'display:none;'}" aria-live="polite">
        ${answered ? ((answers[idx] && answers[idx].toUpperCase()) === correctLetter ? "Correct! ✓" : "Incorrect ✗") : ""}
      </div>
    `;

    if (answered) {
      const isCorrect = (answers[idx] && answers[idx].toUpperCase()) === correctLetter;
      card.querySelector(`#result${q.id}`).classList.add(isCorrect ? 'correct' : 'wrong');
    }

    container.appendChild(card);
  });

  progress.textContent = `Questions ${start + 1} – ${end} of ${quizData.length}`;

  prevBtn.disabled = currentPage === 0;
  nextBtn.textContent = end >= quizData.length ? 'Finish Test' : 'Next Page';

  attachSubmitListeners();
}

function attachSubmitListeners() {
  quizData.forEach(q => {
    const submit = document.getElementById(`submit${q.id}`);
    if (!submit) return;

    const radios = document.querySelectorAll(`input[name="q${q.id}"]`);

    radios.forEach(radio => {
      radio.addEventListener('change', () => {
        if (!radio.disabled) submit.disabled = false;
      });
    });

    submit.addEventListener('click', () => {
      const selected = document.querySelector(`input[name="q${q.id}"]:checked`);
      if (!selected) return;

      const idx = q.id - 1;
      answers[idx] = selected.value.toUpperCase();

      submit.classList.add('hidden');
      radios.forEach(r => r.disabled = true);

      const res = document.getElementById(`result${q.id}`);
      res.style.display = 'block';

      const correctLetter = (q.correct ?? q.correct_answer ?? q.correctAnswer ?? '').toString().trim().toUpperCase();

      if (answers[idx] === correctLetter) {
        res.textContent = "Correct! ✓";
        res.classList.add('correct');
        score++;
      } else {
        res.textContent = "Incorrect ✗";
        res.classList.add('wrong');
      }
    });
  });
}

prevBtn.addEventListener('click', () => {
  if (currentPage > 0) {
    currentPage--;
    renderPage();
  }
});

nextBtn.addEventListener('click', () => {
  const maxPage = Math.ceil(quizData.length / questionsPerPage) - 1;
  if (currentPage < maxPage) {
    currentPage++;
    renderPage();
  } else {
    const percent = Math.round((score / quizData.length) * 100);
    summaryDiv.innerHTML = `Test Complete!<br>Your Score: ${score} / ${quizData.length} (${percent}%)`;
    summaryDiv.style.display = 'block';
    document.getElementById('nav').style.display = 'none';
    progress.style.display = 'none';
  }
});

window.addEventListener('resize', () => {
  const newPerPage = isMobile() ? questionsPerPageMobile : questionsPerPageDesktop;
  if (newPerPage !== questionsPerPage) {
    questionsPerPage = newPerPage;
    currentPage = 0;
    renderPage();
  }
});

loadQuestions();
</script>
</body>
</html>